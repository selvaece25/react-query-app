!function(e,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("react")):"function"==typeof define&&define.amd?define(["exports","react"],r):r((e=e||self).ReactQuery={},e.React)}(this,(function(e,r){"use strict";function t(){return(t=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function n(e,r){if(null==e)return{};var t,n,u={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||(u[t]=e[t]);return u}r=r&&r.hasOwnProperty("default")?r.default:r;var u=0,o=function(){return u++},i={},c="undefined"==typeof window,a=function(){},s=console||{error:a,warn:a,log:a};function f(e){var t=r.useRef();return t.current=e,r.useCallback((function(){return t.current}),[])}function l(e,r){return"function"==typeof e?e(r):e}function d(e,r){return v(r)?Object.assign.apply(Object,[{}].concat(Object.keys(r).sort().map((function(e){var t;return(t={})[e]=r[e],t})))):r}function h(e){return JSON.stringify(e,d)}function v(e){return e&&"object"==typeof e&&!Array.isArray(e)}function y(){return"undefined"==typeof document||void 0===document.visibilityState||"visible"===document.visibilityState||"prerender"===document.visibilityState}function p(e){if(v(e[0])){if(e[0].hasOwnProperty("queryKey")&&e[0].hasOwnProperty("queryFn")){var r=e[0],t=r.queryKey,n=r.variables,u=void 0===n?[]:n,o=r.queryFn,i=r.config;return[t,u,o,void 0===i?{}:i]}throw new Error("queryKey and queryFn keys are required.")}if("function"==typeof e[2]){var c=e[0],a=e[1],s=void 0===a?[]:a,f=e[2],l=e[3];return[c,s,f,void 0===l?{}:l]}var d=e[0],h=e[1],y=e[2];return[d,[],h,void 0===y?{}:y]}function g(e){var t=r.useRef(!1);return r[c?"useEffect":"useLayoutEffect"]((function(){return t.current=!0,function(){return t.current=!1}}),[]),r.useCallback((function(){return t.current?e.apply(void 0,arguments):void 0}),[e])}function m(e){if((e.config.suspense||e.config.useErrorBoundary)&&"error"===e.status)throw e.error;if(e.config.suspense&&"loading"===e.status)throw e.wasSuspensed=!0,e.refetch()}var q=r.createContext(),w={current:{retry:3,retryDelay:function(e){return Math.min(1e3*Math.pow(2,e),3e4)},staleTime:0,cacheTime:3e5,refetchAllOnWindowFocus:!0,refetchInterval:!1,suspense:!1,queryKeySerializerFn:function e(r){if(!r)return[];if("function"==typeof r)try{return e(r())}catch(e){return[]}"string"==typeof r&&(r=[r]);var t=h(r);return r=JSON.parse(t),[t,r]},queryFnParamsFilter:function(e){return e},throwOnError:!1,useErrorBoundary:void 0,onMutate:a,onSuccess:a,onError:a,onSettled:a,refetchOnMount:!0}};function b(){return r.useContext(q)||w.current}function F(e,r,t){return t?r?r(e):e:(e&&e.then||(e=Promise.resolve(e)),r?e.then(r):e)}function S(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}function E(e){return function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];try{return Promise.resolve(e.apply(this,r))}catch(e){return Promise.reject(e)}}}function O(e,r){var t=e();return t&&t.then?t.then(r):r(t)}var P=function(){var e=[],r={queries:{},isFetching:0},u=function(){r.isFetching=Object.values(P.queries).reduce((function(e,r){return r.state.isFetching?e+1:e}),0),e.forEach((function(e){return e(r)}))};r.subscribe=function(r){return e.push(r),function(){e.splice(e.indexOf(r),1)}},r.clear=function(){r.queries={},u()};var o=function(e,t){var n=(void 0===t?{}:t).exact;if("function"!=typeof e){var u=w.current.queryKeySerializerFn(e),o=u[0],i=u[1];e=function(e){return n?e.queryHash===o:function e(r,t){return typeof r==typeof t&&("object"==typeof r?!Object.keys(t).some((function(n){return!e(r[n],t[n])})):r===t)}(e.queryKey,i)}}return Object.values(r.queries).filter(e)};return r.getQueries=o,r.getQuery=function(e){return o(e,{exact:!0})[0]},r.getQueryData=function(e){var t;return null==(t=r.getQuery(e))?void 0:t.state.data},r.removeQueries=function(e,t){var n=(void 0===t?{}:t).exact,i=o(e,{exact:n});i.forEach((function(e){clearTimeout(e.staleTimeout),delete r.queries[e.queryHash]})),i.length&&u()},r.refetchQueries=E((function(e,t){var n=void 0===t?{}:t,u=n.exact,i=n.throwOnError,c=n.force,a=!0===e?Object.values(r.queries):o(e,{exact:u});return S((function(){return F(Promise.all(a.map((function(e){return e.fetch({force:c})}))))}),(function(e){if(i)throw e}))})),r._buildQuery=function(e,n,o,s){var f=s.queryKeySerializerFn(e),d=f[0],h=f[1],v=r.queries[d];return v?(Object.assign(v,{queryVariables:n,queryFn:o}),Object.assign(v.config,s)):((v=function(e){var n=e.config.queryReducer||x,o=void 0===e.queryHash,c="function"==typeof e.config.initialData?e.config.initialData():e.config.initialData,s=void 0!==c,f=!!o||!s,d=e.config.manual,h=t({},e,{instances:[],state:n(void 0,{type:C,initialStatus:o||d||s?"success":"loading",initialData:c,hasInitialData:s,isStale:f,manual:d})}),v=function(e){h.state=n(h.state,e),h.instances.forEach((function(e){return e.onStateUpdate(h.state)})),u()};h.scheduleStaleTimeout=function(){h.config.staleTime!==1/0&&(h.staleTimeout=setTimeout((function(){P.getQuery(h.queryKey)&&v({type:I})}),h.config.staleTime))},h.scheduleGarbageCollection=function(){v({type:Q}),h.cacheTimeout=setTimeout((function(){r.removeQueries((function(e){return e.state.markedForGarbageCollection&&e.queryHash===h.queryHash}))}),void 0===h.state.data&&"error"!==h.state.status?0:h.config.cacheTime)},h.heal=function(){clearTimeout(h.cacheTimeout),h.cancelled=null},h.subscribe=function(e){var r=h.instances.find((function(r){return r.id===e.id}));return r?Object.assign(r,e):(r=t({onStateUpdate:a},e),h.instances.push(e)),h.heal(),function(){h.instances=h.instances.filter((function(r){return r.id!==e.id})),h.instances.length||(h.cancelled=i,h.cancelQueries&&h.cancelQueries(),h.scheduleGarbageCollection())}};var p=E((function(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];return S((function(){var r=e.apply(void 0,h.config.queryFnParamsFilter(t));return h.cancelQueries=function(){return null==r.cancel?void 0:r.cancel()},F(r,(function(e){if(delete h.cancelQueries,h.cancelled)throw h.cancelled;return e}))}),(function(r){var n=!1;if(delete h.cancelQueries,h.cancelled)throw h.cancelled;return v({type:M}),O((function(){if(!0===h.config.retry||h.state.failureCount<=h.config.retry||"function"==typeof h.config.retry&&h.config.retry(h.state.failureCount,r)){if(!y())return h.shouldContinueRetryOnFocus=!0,n=!0,new Promise(a);delete h.shouldContinueRetryOnFocus;var u=l(h.config.retryDelay,h.state.failureCount);return n=!0,F(new Promise((function(r,n){setTimeout(E((function(){return h.cancelled?n(h.cancelled):S((function(){return F(p.apply(void 0,[e].concat(t)),(function(e){if(h.cancelled)return n(h.cancelled);r(e)}))}),(function(e){if(h.cancelled)return n(h.cancelled);n(e)}))})),u)})))}}),(function(e){if(n)return e;throw r}))}))}));return h.fetch=E((function(e){var r=void 0===e?{}:e,t=r.force,n=r.__queryFn,u=void 0===n?h.queryFn:n;if(h.queryHash&&(h.state.isStale||t))return h.promise||(h.promise=E((function(){return h.cancelled=null,S((function(){return v({type:j}),F(p.apply(void 0,[u].concat(h.queryKey,h.queryVariables)),(function(e){return h.setData(e),h.instances.forEach((function(e){return e.onSuccess&&e.onSuccess(h.state.data)})),h.instances.forEach((function(e){return e.onSettled&&e.onSettled(h.state.data,null)})),delete h.promise,e}))}),(function(e){if(v({type:T,cancelled:e===h.cancelled,error:e}),delete h.promise,e!==h.cancelled)throw h.instances.forEach((function(r){return r.onError&&r.onError(e)})),h.instances.forEach((function(r){return r.onSettled&&r.onSettled(void 0,e)})),e}))}))()),h.promise})),h.setData=function(e){v({type:D,updater:e}),clearTimeout(h.staleTimeout),h.scheduleStaleTimeout()},h}({queryKey:h,queryHash:d,queryVariables:n,queryFn:o,config:s})).state.data&&(v.scheduleStaleTimeout(),v.heal(),v.scheduleGarbageCollection()),v.queryHash&&(c||(r.queries[d]=v,setTimeout((function(){u()}))))),v},r.prefetchQuery=E((function(){for(var e=!1,u=arguments.length,o=new Array(u),i=0;i<u;i++)o[i]=arguments[i];var c=p(o),a=c[0],s=c[1],f=c[2],l=c[3],d=l.force,h=n(l,["force"]);h=t({},w.current,{},h);var v=r._buildQuery(a,s,f,h);return O((function(){if(v.state.isStale||d)return S((function(){return F(v.fetch({force:d}),(function(r){return v.wasPrefetched=!0,e=!0,r}))}),(function(e){if(h.throwOnError)throw e}))}),(function(r){return e?r:v.state.data}))})),r.setQueryData=function(e,u,i){void 0===i&&(i={});var c=i,s=c.exact,f=n(c,["exact"]),l=o(e,{exact:s});l.length||"function"==typeof e||(l=[r._buildQuery(e,void 0,(function(){return new Promise(a)}),t({},w.current,{},f))]),l.forEach((function(e){return e.setData(u)}))},r}(),C={},M={},I={},Q={},j={},D={},T={};function x(e,r){switch(r.type){case C:return{status:r.initialStatus,error:null,isFetching:!r.hasInitialData&&!r.manual,canFetchMore:!1,failureCount:0,isStale:r.isStale,markedForGarbageCollection:!1,data:r.initialData,updatedAt:r.hasInitialData?Date.now():0};case M:return t({},e,{failureCount:e.failureCount+1});case I:return t({},e,{isStale:!0});case Q:return t({},e,{markedForGarbageCollection:!0});case j:return t({},e,{status:"error"===e.status?"loading":e.status,isFetching:!0,failureCount:0});case D:return t({},e,{status:"success",data:l(r.updater,e.data),error:null,isStale:!1,isFetching:!1,canFetchMore:r.canFetchMore,updatedAt:Date.now(),failureCount:0});case T:return t({},e,{isFetching:!1,isStale:!0},!r.cancelled&&{status:"error",error:r.error});default:throw new Error}}var k,R=function(){var e=w.current.refetchAllOnWindowFocus;y()&&(void 0===navigator.onLine||navigator.onLine)&&P.refetchQueries((function(r){return!!r.instances.length&&(!0!==r.config.manual&&(r.shouldContinueRetryOnFocus?(delete r.promise,!0):void 0===r.config.refetchOnWindowFocus?e:r.config.refetchOnWindowFocus))})).catch(s.error)};function A(e){k&&k(),k=e(R)}function H(e,r,t){return t?r?r(e):e:(e&&e.then||(e=Promise.resolve(e)),r?e.then(r):e)}A((function(e){var r;if(!c&&(null==(r=window)?void 0:r.addEventListener))return window.addEventListener("visibilitychange",e,!1),window.addEventListener("focus",e,!1),function(){window.removeEventListener("visibilitychange",e),window.removeEventListener("focus",e)}}));var K=function(){return{status:"idle",data:void 0,error:null}};function _(){}var L={};function V(e,r){if(!r)return e&&e.then?e.then(_):Promise.resolve()}var B={};function G(e,r){var t=e();return t&&t.then?t.then(r):r(t)}var W={};var z={};function U(e){return function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];try{return Promise.resolve(e.apply(this,r))}catch(e){return Promise.reject(e)}}}function J(e,r){if(r.type===L)return{status:"idle",data:void 0,error:null};if(r.type===B)return{status:"loading"};if(r.type===W)return{status:"success",data:r.data};if(r.type===z)return{status:"error",error:r.error};throw new Error}function N(e,u,i,c){void 0===c&&(c={});var a,l=(null===(a=r.useRef(null)).current&&(a.current=o()),a.current);c=t({},b(),{},c);var d=r.useRef(),h=P._buildQuery(e,u,i,c);d.current&&void 0===d.current.queryHash&&void 0===h.queryHash||(d.current=h);var v,p=d.current,m=g(r.useState()[1]),q=f(c),w=r.useCallback((v=function(e){void 0===e&&(e={});var r=e,t=r.throwOnError,u=n(r,["throwOnError"]);return function(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}((function(){return e=p.fetch(u),t?r?r(e):e:(e&&e.then||(e=Promise.resolve(e)),r?e.then(r):e);var e,r,t}),(function(e){if(t)throw e}))},function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];try{return Promise.resolve(v.apply(this,e))}catch(e){return Promise.reject(e)}}),[p]);return r.useEffect((function(){var e=p.subscribe({id:l,onStateUpdate:function(){return m({})},onSuccess:function(e){return q().onSuccess(e)},onError:function(e){return q().onError(e)},onSettled:function(e,r){return q().onSettled(e,r)}});return q().manual||p.wasPrefetched||p.wasSuspensed||!p.state.isStale||!q().refetchOnMount&&1!==p.instances.length||w().catch(s.error),p.wasPrefetched=!1,p.wasSuspensed=!1,e}),[q,l,p,w,m]),r.useEffect((function(){if(c.refetchInterval&&(!p.refetchInterval||c.refetchInterval<p.refetchInterval))return clearInterval(p.refetchInterval),p.refetchInterval=setInterval((function(){(y()||c.refetchIntervalInBackground)&&w().catch(s.error)}),c.refetchInterval),function(){clearInterval(p.refetchInterval),delete p.refetchInterval}}),[c.refetchInterval,c.refetchIntervalInBackground,p.refetchInterval,w]),t({},p.state,{config:c,query:p,refetch:w})}function X(e,r,t){return t?r?r(e):e:(e&&e.then||(e=Promise.resolve(e)),r?e.then(r):e)}function Y(e){return function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];try{return Promise.resolve(e.apply(this,r))}catch(e){return Promise.reject(e)}}}function Z(e,r){if(e)throw r;return r}function $(e,r){try{var t=e()}catch(e){return r(!0,e)}return t&&t.then?t.then(r.bind(null,!1),r.bind(null,!0)):r(!1,t)}e.ReactQueryConfigProvider=function(e){var n=e.config,u=e.children,o=r.useContext(q),i=r.useMemo((function(){var e=t({},o||w.current,{},n);return void 0===e.useErrorBoundary&&(e.useErrorBoundary=e.suspense),e}),[n,o]);return o||(w.current=i),r.createElement(q.Provider,{value:i},u)},e.queryCache=P,e.setConsole=function(e){s=e},e.setFocusHandler=A,e.stableStringify=h,e.statusError="error",e.statusIdle="idle",e.statusLoading="loading",e.statusSuccess="success",e.useInfiniteQuery=function(){for(var e=r.useRef(),n=arguments.length,u=new Array(n),o=0;o<n;o++)u[o]=arguments[o];var i=p(u),c=i[0],a=i[1],s=i[2],l=i[3],d=void 0===l?{}:l,h=d.getFetchMore,v=f(h),y=s,g=N(c,a,s=Y((function(){return X(Promise.all(e.current.query.pageVariables.map((function(e){return y.apply(void 0,e)}))),(function(r){return e.current.query.canFetchMore=v()(r[r.length-1],r),r}))})),d);void 0===g.query.canFetchMore&&void 0!==g.data&&(g.query.canFetchMore=v()(g.data[g.data.length-1],g.data)),e.current=g;var q=g.refetch,w=g.data,b=void 0===w?[]:w,F=g.query.canFetchMore;g.query.pageVariables||(g.query.pageVariables=[[].concat(g.query.queryKey,g.query.queryVariables)]);var S=r.useCallback((function(r){return void 0===r&&(r=e.current.query.canFetchMore),e.current.query.canFetchMore?q({force:!0,__queryFn:Y((function(){for(var t=arguments.length,n=new Array(t),u=0;u<t;u++)n[u]=arguments[u];return $((function(){e.current.query.isFetchingMore=!0;var t=[].concat(n,[r]);e.current.query.pageVariables.push(t);var u=e.current.data;return X(y.apply(void 0,t),(function(r){var t=[].concat(u,[r]);return e.current.query.canFetchMore=v()(t[t.length-1],t),t}))}),(function(r,t){return e.current.query.isFetchingMore=!1,Z(r,t)}))}))}):void 0}),[v,y,q]),E=r.useMemo((function(){return!!g.query.isFetchingMore}),[g.query.isFetchingMore]);return m(g),t({},g,{data:b,canFetchMore:F,fetchMore:S,isFetchingMore:E})},e.useIsFetching=function(){var e=r.useState({}),t=e[0],n=e[1];return r.useEffect((function(){return P.subscribe((function(){return n({})}))}),[]),r.useMemo((function(){return t&&P.isFetching}),[t])},e.useMutation=function(e,n){void 0===n&&(n={});var u=r.useReducer(J,null,K),i=u[0],c=g(u[1]),l=f(e),d=f(t({},b(),{},n)),h=r.useRef(),v=r.useCallback(U((function(e,r){var t=void 0===r?{}:r,n=t.onSuccess,u=void 0===n?a:n,i=t.onError,f=void 0===i?a:i,v=t.onSettled,y=void 0===v?a:v,p=t.throwOnError,g=d(),m=o();h.current=m;var q,w=U((function(){return h.current===m}));return c({type:B}),function(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}((function(){return H(g.onMutate(e),(function(r){var t;return q=r,G((function(){if(w())return H(l()(e),(function(e){t=e}))}),(function(){return G((function(){if(w())return V(u(t,e))}),(function(){return G((function(){if(w())return V(g.onSuccess(t,e))}),(function(){return G((function(){if(w())return V(y(t,null,e))}),(function(){return G((function(){if(w())return V(g.onSettled(t,null,e))}),(function(){return w()&&c({type:W,data:t}),t}))}))}))}))}))}))}),(function(r){return G((function(){if(w())return s.error(r),V(f(r,e,q))}),(function(){return G((function(){if(w())return V(g.onError(r,e,q))}),(function(){return G((function(){if(w())return V(y(void 0,r,e,q))}),(function(){return G((function(){if(w())return V(g.onSettled(void 0,r,e,q))}),(function(){if(w()&&(c({type:z,error:r}),null!=p?p:g.throwOnError))throw r}))}))}))}))}))})),[c,d,l]),y=r.useCallback((function(){return c({type:L})}),[c]);return r.useEffect((function(){if(d().useErrorBoundary&&i.error)throw i.error}),[d,i.error]),[v,t({},i,{reset:y})]},e.usePaginatedQuery=function(){for(var e=arguments.length,n=new Array(e),u=0;u<e;u++)n[u]=arguments[u];var o=p(n),i=o[0],c=o[1],a=o[2],s=o[3],f=void 0===s?{}:s,l=r.useRef();void 0!==l.current&&delete f.initialData;var d=N(i,c,a,f),h=d.data,v=d.status;r.useEffect((function(){"success"===v&&void 0!==h&&(l.current=h)}),[h,v]);var y=h;return void 0===y&&(y=l.current),void 0!==y&&(v="success"),m(d),t({},d,{resolvedData:y,latestData:h,status:v})},e.useQuery=function(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];var n=N.apply(void 0,p(r));return m(n),n},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=react-query.production.min.js.map
