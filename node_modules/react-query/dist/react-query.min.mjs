import e from"react";function r(){return(r=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)}function t(e,r){if(null==e)return{};var t,n,u={},o=Object.keys(e);for(n=0;n<o.length;n++)t=o[n],r.indexOf(t)>=0||(u[t]=e[t]);return u}var n="idle",u="loading",o="error",i="success",c=0,a=function(){return c++},s={},f="undefined"==typeof window,l=function(){},d=console||{error:l,warn:l,log:l};function h(e){d=e}function v(r){var t=e.useRef();return t.current=r,e.useCallback((function(){return t.current}),[])}function y(e,r){return"function"==typeof e?e(r):e}function p(e,r){return m(r)?Object.assign.apply(Object,[{}].concat(Object.keys(r).sort().map((function(e){var t;return(t={})[e]=r[e],t})))):r}function g(e){return JSON.stringify(e,p)}function m(e){return e&&"object"==typeof e&&!Array.isArray(e)}function w(){return"undefined"==typeof document||void 0===document.visibilityState||"visible"===document.visibilityState||"prerender"===document.visibilityState}function q(e){if(m(e[0])){if(e[0].hasOwnProperty("queryKey")&&e[0].hasOwnProperty("queryFn")){var r=e[0],t=r.queryKey,n=r.variables,u=void 0===n?[]:n,o=r.queryFn,i=r.config;return[t,u,o,void 0===i?{}:i]}throw new Error("queryKey and queryFn keys are required.")}if("function"==typeof e[2]){var c=e[0],a=e[1],s=void 0===a?[]:a,f=e[2],l=e[3];return[c,s,f,void 0===l?{}:l]}var d=e[0],h=e[1],v=e[2];return[d,[],h,void 0===v?{}:v]}function b(r){var t=e.useRef(!1);return e[f?"useEffect":"useLayoutEffect"]((function(){return t.current=!0,function(){return t.current=!1}}),[]),e.useCallback((function(){return t.current?r.apply(void 0,arguments):void 0}),[r])}function F(e){if((e.config.suspense||e.config.useErrorBoundary)&&"error"===e.status)throw e.error;if(e.config.suspense&&"loading"===e.status)throw e.wasSuspensed=!0,e.refetch()}var S=e.createContext(),E={current:{retry:3,retryDelay:function(e){return Math.min(1e3*Math.pow(2,e),3e4)},staleTime:0,cacheTime:3e5,refetchAllOnWindowFocus:!0,refetchInterval:!1,suspense:!1,queryKeySerializerFn:function e(r){if(!r)return[];if("function"==typeof r)try{return e(r())}catch(e){return[]}"string"==typeof r&&(r=[r]);var t=g(r);return r=JSON.parse(t),[t,r]},queryFnParamsFilter:function(e){return e},throwOnError:!1,useErrorBoundary:void 0,onMutate:l,onSuccess:l,onError:l,onSettled:l,refetchOnMount:!0}};function O(){return e.useContext(S)||E.current}function M(t){var n=t.config,u=t.children,o=e.useContext(S),i=e.useMemo((function(){var e=r({},o||E.current,{},n);return void 0===e.useErrorBoundary&&(e.useErrorBoundary=e.suspense),e}),[n,o]);return o||(E.current=i),e.createElement(S.Provider,{value:i},u)}function P(e,r,t){return t?r?r(e):e:(e&&e.then||(e=Promise.resolve(e)),r?e.then(r):e)}function C(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}function I(e){return function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];try{return Promise.resolve(e.apply(this,r))}catch(e){return Promise.reject(e)}}}function D(e,r){var t=e();return t&&t.then?t.then(r):r(t)}var Q=function(){var e=[],n={queries:{},isFetching:0},u=function(){n.isFetching=Object.values(Q.queries).reduce((function(e,r){return r.state.isFetching?e+1:e}),0),e.forEach((function(e){return e(n)}))};n.subscribe=function(r){return e.push(r),function(){e.splice(e.indexOf(r),1)}},n.clear=function(){n.queries={},u()};var o=function(e,r){var t=(void 0===r?{}:r).exact;if("function"!=typeof e){var u=E.current.queryKeySerializerFn(e),o=u[0],i=u[1];e=function(e){return t?e.queryHash===o:function e(r,t){return typeof r==typeof t&&("object"==typeof r?!Object.keys(t).some((function(n){return!e(r[n],t[n])})):r===t)}(e.queryKey,i)}}return Object.values(n.queries).filter(e)};return n.getQueries=o,n.getQuery=function(e){return o(e,{exact:!0})[0]},n.getQueryData=function(e){var r;return null==(r=n.getQuery(e))?void 0:r.state.data},n.removeQueries=function(e,r){var t=(void 0===r?{}:r).exact,i=o(e,{exact:t});i.forEach((function(e){clearTimeout(e.staleTimeout),delete n.queries[e.queryHash]})),i.length&&u()},n.refetchQueries=I((function(e,r){var t=void 0===r?{}:r,u=t.exact,i=t.throwOnError,c=t.force,a=!0===e?Object.values(n.queries):o(e,{exact:u});return C((function(){return P(Promise.all(a.map((function(e){return e.fetch({force:c})}))))}),(function(e){if(i)throw e}))})),n._buildQuery=function(e,t,o,i){var c=i.queryKeySerializerFn(e),a=c[0],d=c[1],h=n.queries[a];return h?(Object.assign(h,{queryVariables:t,queryFn:o}),Object.assign(h.config,i)):((h=function(e){var t=e.config.queryReducer||H,o=void 0===e.queryHash,i="function"==typeof e.config.initialData?e.config.initialData():e.config.initialData,c=void 0!==i,a=!!o||!c,f=e.config.manual,d=r({},e,{instances:[],state:t(void 0,{type:T,initialStatus:o||f||c?"success":"loading",initialData:i,hasInitialData:c,isStale:a,manual:f})}),h=function(e){d.state=t(d.state,e),d.instances.forEach((function(e){return e.onStateUpdate(d.state)})),u()};d.scheduleStaleTimeout=function(){d.config.staleTime!==1/0&&(d.staleTimeout=setTimeout((function(){Q.getQuery(d.queryKey)&&h({type:k})}),d.config.staleTime))},d.scheduleGarbageCollection=function(){h({type:x}),d.cacheTimeout=setTimeout((function(){n.removeQueries((function(e){return e.state.markedForGarbageCollection&&e.queryHash===d.queryHash}))}),void 0===d.state.data&&"error"!==d.state.status?0:d.config.cacheTime)},d.heal=function(){clearTimeout(d.cacheTimeout),d.cancelled=null},d.subscribe=function(e){var t=d.instances.find((function(r){return r.id===e.id}));return t?Object.assign(t,e):(t=r({onStateUpdate:l},e),d.instances.push(e)),d.heal(),function(){d.instances=d.instances.filter((function(r){return r.id!==e.id})),d.instances.length||(d.cancelled=s,d.cancelQueries&&d.cancelQueries(),d.scheduleGarbageCollection())}};var v=I((function(e){for(var r=arguments.length,t=new Array(r>1?r-1:0),n=1;n<r;n++)t[n-1]=arguments[n];return C((function(){var r=e.apply(void 0,d.config.queryFnParamsFilter(t));return d.cancelQueries=function(){return null==r.cancel?void 0:r.cancel()},P(r,(function(e){if(delete d.cancelQueries,d.cancelled)throw d.cancelled;return e}))}),(function(r){var n=!1;if(delete d.cancelQueries,d.cancelled)throw d.cancelled;return h({type:j}),D((function(){if(!0===d.config.retry||d.state.failureCount<=d.config.retry||"function"==typeof d.config.retry&&d.config.retry(d.state.failureCount,r)){if(!w())return d.shouldContinueRetryOnFocus=!0,n=!0,new Promise(l);delete d.shouldContinueRetryOnFocus;var u=y(d.config.retryDelay,d.state.failureCount);return n=!0,P(new Promise((function(r,n){setTimeout(I((function(){return d.cancelled?n(d.cancelled):C((function(){return P(v.apply(void 0,[e].concat(t)),(function(e){if(d.cancelled)return n(d.cancelled);r(e)}))}),(function(e){if(d.cancelled)return n(d.cancelled);n(e)}))})),u)})))}}),(function(e){if(n)return e;throw r}))}))}));return d.fetch=I((function(e){var r=void 0===e?{}:e,t=r.force,n=r.__queryFn,u=void 0===n?d.queryFn:n;if(d.queryHash&&(d.state.isStale||t))return d.promise||(d.promise=I((function(){return d.cancelled=null,C((function(){return h({type:A}),P(v.apply(void 0,[u].concat(d.queryKey,d.queryVariables)),(function(e){return d.setData(e),d.instances.forEach((function(e){return e.onSuccess&&e.onSuccess(d.state.data)})),d.instances.forEach((function(e){return e.onSettled&&e.onSettled(d.state.data,null)})),delete d.promise,e}))}),(function(e){if(h({type:K,cancelled:e===d.cancelled,error:e}),delete d.promise,e!==d.cancelled)throw d.instances.forEach((function(r){return r.onError&&r.onError(e)})),d.instances.forEach((function(r){return r.onSettled&&r.onSettled(void 0,e)})),e}))}))()),d.promise})),d.setData=function(e){h({type:R,updater:e}),clearTimeout(d.staleTimeout),d.scheduleStaleTimeout()},d}({queryKey:d,queryHash:a,queryVariables:t,queryFn:o,config:i})).state.data&&(h.scheduleStaleTimeout(),h.heal(),h.scheduleGarbageCollection()),h.queryHash&&(f||(n.queries[a]=h,setTimeout((function(){u()}))))),h},n.prefetchQuery=I((function(){for(var e=!1,u=arguments.length,o=new Array(u),i=0;i<u;i++)o[i]=arguments[i];var c=q(o),a=c[0],s=c[1],f=c[2],l=c[3],d=l.force,h=t(l,["force"]);h=r({},E.current,{},h);var v=n._buildQuery(a,s,f,h);return D((function(){if(v.state.isStale||d)return C((function(){return P(v.fetch({force:d}),(function(r){return v.wasPrefetched=!0,e=!0,r}))}),(function(e){if(h.throwOnError)throw e}))}),(function(r){return e?r:v.state.data}))})),n.setQueryData=function(e,u,i){void 0===i&&(i={});var c=i,a=c.exact,s=t(c,["exact"]),f=o(e,{exact:a});f.length||"function"==typeof e||(f=[n._buildQuery(e,void 0,(function(){return new Promise(l)}),r({},E.current,{},s))]),f.forEach((function(e){return e.setData(u)}))},n}(),T={},j={},k={},x={},A={},R={},K={};function H(e,t){switch(t.type){case T:return{status:t.initialStatus,error:null,isFetching:!t.hasInitialData&&!t.manual,canFetchMore:!1,failureCount:0,isStale:t.isStale,markedForGarbageCollection:!1,data:t.initialData,updatedAt:t.hasInitialData?Date.now():0};case j:return r({},e,{failureCount:e.failureCount+1});case k:return r({},e,{isStale:!0});case x:return r({},e,{markedForGarbageCollection:!0});case A:return r({},e,{status:"error"===e.status?"loading":e.status,isFetching:!0,failureCount:0});case R:return r({},e,{status:"success",data:y(t.updater,e.data),error:null,isStale:!1,isFetching:!1,canFetchMore:t.canFetchMore,updatedAt:Date.now(),failureCount:0});case K:return r({},e,{isFetching:!1,isStale:!0},!t.cancelled&&{status:"error",error:t.error});default:throw new Error}}var L,V=function(){var e=E.current.refetchAllOnWindowFocus;w()&&(void 0===navigator.onLine||navigator.onLine)&&Q.refetchQueries((function(r){return!!r.instances.length&&(!0!==r.config.manual&&(r.shouldContinueRetryOnFocus?(delete r.promise,!0):void 0===r.config.refetchOnWindowFocus?e:r.config.refetchOnWindowFocus))})).catch(d.error)};function _(e){L&&L(),L=e(V)}function B(){var r=e.useState({}),t=r[0],n=r[1];return e.useEffect((function(){return Q.subscribe((function(){return n({})}))}),[]),e.useMemo((function(){return t&&Q.isFetching}),[t])}function G(e,r,t){return t?r?r(e):e:(e&&e.then||(e=Promise.resolve(e)),r?e.then(r):e)}_((function(e){var r;if(!f&&(null==(r=window)?void 0:r.addEventListener))return window.addEventListener("visibilitychange",e,!1),window.addEventListener("focus",e,!1),function(){window.removeEventListener("visibilitychange",e),window.removeEventListener("focus",e)}}));var W=function(){return{status:"idle",data:void 0,error:null}};function z(){}var U={};function J(e,r){if(!r)return e&&e.then?e.then(z):Promise.resolve()}var N={};function X(e,r){var t=e();return t&&t.then?t.then(r):r(t)}var Y={};var Z={};function $(e){return function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];try{return Promise.resolve(e.apply(this,r))}catch(e){return Promise.reject(e)}}}function ee(e,r){if(r.type===U)return{status:"idle",data:void 0,error:null};if(r.type===N)return{status:"loading"};if(r.type===Y)return{status:"success",data:r.data};if(r.type===Z)return{status:"error",error:r.error};throw new Error}function re(t,n){void 0===n&&(n={});var u=e.useReducer(ee,null,W),o=u[0],i=b(u[1]),c=v(t),s=v(r({},O(),{},n)),f=e.useRef(),h=e.useCallback($((function(e,r){var t=void 0===r?{}:r,n=t.onSuccess,u=void 0===n?l:n,o=t.onError,h=void 0===o?l:o,v=t.onSettled,y=void 0===v?l:v,p=t.throwOnError,g=s(),m=a();f.current=m;var w,q=$((function(){return f.current===m}));return i({type:N}),function(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}((function(){return G(g.onMutate(e),(function(r){var t;return w=r,X((function(){if(q())return G(c()(e),(function(e){t=e}))}),(function(){return X((function(){if(q())return J(u(t,e))}),(function(){return X((function(){if(q())return J(g.onSuccess(t,e))}),(function(){return X((function(){if(q())return J(y(t,null,e))}),(function(){return X((function(){if(q())return J(g.onSettled(t,null,e))}),(function(){return q()&&i({type:Y,data:t}),t}))}))}))}))}))}))}),(function(r){return X((function(){if(q())return d.error(r),J(h(r,e,w))}),(function(){return X((function(){if(q())return J(g.onError(r,e,w))}),(function(){return X((function(){if(q())return J(y(void 0,r,e,w))}),(function(){return X((function(){if(q())return J(g.onSettled(void 0,r,e,w))}),(function(){if(q()&&(i({type:Z,error:r}),null!=p?p:g.throwOnError))throw r}))}))}))}))}))})),[i,s,c]),y=e.useCallback((function(){return i({type:U})}),[i]);return e.useEffect((function(){if(s().useErrorBoundary&&o.error)throw o.error}),[s,o.error]),[h,r({},o,{reset:y})]}function te(n,u,o,i){void 0===i&&(i={});var c,s=(null===(c=e.useRef(null)).current&&(c.current=a()),c.current);i=r({},O(),{},i);var f=e.useRef(),l=Q._buildQuery(n,u,o,i);f.current&&void 0===f.current.queryHash&&void 0===l.queryHash||(f.current=l);var h,y=f.current,p=b(e.useState()[1]),g=v(i),m=e.useCallback((h=function(e){void 0===e&&(e={});var r=e,n=r.throwOnError,u=t(r,["throwOnError"]);return function(e,r){try{var t=e()}catch(e){return r(e)}return t&&t.then?t.then(void 0,r):t}((function(){return e=y.fetch(u),t?r?r(e):e:(e&&e.then||(e=Promise.resolve(e)),r?e.then(r):e);var e,r,t}),(function(e){if(n)throw e}))},function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];try{return Promise.resolve(h.apply(this,e))}catch(e){return Promise.reject(e)}}),[y]);return e.useEffect((function(){var e=y.subscribe({id:s,onStateUpdate:function(){return p({})},onSuccess:function(e){return g().onSuccess(e)},onError:function(e){return g().onError(e)},onSettled:function(e,r){return g().onSettled(e,r)}});return g().manual||y.wasPrefetched||y.wasSuspensed||!y.state.isStale||!g().refetchOnMount&&1!==y.instances.length||m().catch(d.error),y.wasPrefetched=!1,y.wasSuspensed=!1,e}),[g,s,y,m,p]),e.useEffect((function(){if(i.refetchInterval&&(!y.refetchInterval||i.refetchInterval<y.refetchInterval))return clearInterval(y.refetchInterval),y.refetchInterval=setInterval((function(){(w()||i.refetchIntervalInBackground)&&m().catch(d.error)}),i.refetchInterval),function(){clearInterval(y.refetchInterval),delete y.refetchInterval}}),[i.refetchInterval,i.refetchIntervalInBackground,y.refetchInterval,m]),r({},y.state,{config:i,query:y,refetch:m})}function ne(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];var n=te.apply(void 0,q(r));return F(n),n}function ue(){for(var t=arguments.length,n=new Array(t),u=0;u<t;u++)n[u]=arguments[u];var o=q(n),i=o[0],c=o[1],a=o[2],s=o[3],f=void 0===s?{}:s,l=e.useRef();void 0!==l.current&&delete f.initialData;var d=te(i,c,a,f),h=d.data,v=d.status;e.useEffect((function(){"success"===v&&void 0!==h&&(l.current=h)}),[h,v]);var y=h;return void 0===y&&(y=l.current),void 0!==y&&(v="success"),F(d),r({},d,{resolvedData:y,latestData:h,status:v})}function oe(e,r,t){return t?r?r(e):e:(e&&e.then||(e=Promise.resolve(e)),r?e.then(r):e)}function ie(e){return function(){for(var r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];try{return Promise.resolve(e.apply(this,r))}catch(e){return Promise.reject(e)}}}function ce(e,r){if(e)throw r;return r}function ae(e,r){try{var t=e()}catch(e){return r(!0,e)}return t&&t.then?t.then(r.bind(null,!1),r.bind(null,!0)):r(!1,t)}function se(){for(var t=e.useRef(),n=arguments.length,u=new Array(n),o=0;o<n;o++)u[o]=arguments[o];var i=q(u),c=i[0],a=i[1],s=i[2],f=i[3],l=void 0===f?{}:f,d=l.getFetchMore,h=v(d),y=s,p=te(c,a,s=ie((function(){return oe(Promise.all(t.current.query.pageVariables.map((function(e){return y.apply(void 0,e)}))),(function(e){return t.current.query.canFetchMore=h()(e[e.length-1],e),e}))})),l);void 0===p.query.canFetchMore&&void 0!==p.data&&(p.query.canFetchMore=h()(p.data[p.data.length-1],p.data)),t.current=p;var g=p.refetch,m=p.data,w=void 0===m?[]:m,b=p.query.canFetchMore;p.query.pageVariables||(p.query.pageVariables=[[].concat(p.query.queryKey,p.query.queryVariables)]);var S=e.useCallback((function(e){return void 0===e&&(e=t.current.query.canFetchMore),t.current.query.canFetchMore?g({force:!0,__queryFn:ie((function(){for(var r=arguments.length,n=new Array(r),u=0;u<r;u++)n[u]=arguments[u];return ae((function(){t.current.query.isFetchingMore=!0;var r=[].concat(n,[e]);t.current.query.pageVariables.push(r);var u=t.current.data;return oe(y.apply(void 0,r),(function(e){var r=[].concat(u,[e]);return t.current.query.canFetchMore=h()(r[r.length-1],r),r}))}),(function(e,r){return t.current.query.isFetchingMore=!1,ce(e,r)}))}))}):void 0}),[h,y,g]),E=e.useMemo((function(){return!!p.query.isFetchingMore}),[p.query.isFetchingMore]);return F(p),r({},p,{data:w,canFetchMore:b,fetchMore:S,isFetchingMore:E})}export{M as ReactQueryConfigProvider,Q as queryCache,h as setConsole,_ as setFocusHandler,g as stableStringify,o as statusError,n as statusIdle,u as statusLoading,i as statusSuccess,se as useInfiniteQuery,B as useIsFetching,re as useMutation,ue as usePaginatedQuery,ne as useQuery};
//# sourceMappingURL=react-query.min.mjs.map
